{% extends "base.html" %}

{% block body %}
{% raw %}
<div class="multiview" ng-controller="MultiViewController as multi_view">
    <div class="rowcontainer">
        <div class="columncontainer" ng-repeat="column in multi_view.columns">
            <div class="close-column" ng-click="multi_view.close_column($index)">
                -
            </div>
            <div id="{{menu.html_id}}" class="mvitem"
                        ng-repeat="item in column.items track by $index"
                        ng-controller="ItemViewMenuController as menu">
                <ul class="itemheader">
                    <li ng-click="menu.set_tab('tree')" translate>Tree</li>
                    <li ng-click="menu.set_tab('info')" translate>Info</li>
                    <li ng-click="menu.set_tab('search')" translate>Search</li>
                    <li ng-click="menu.set_tab('map')" translate>Map</li>
                    <li ng-click="menu.testzoom()">locate</li>
                    <li ng-click="menu.set_tab('testnote')" ng-show="menu.testnote !== null" translate>Testnote</li>
                    <li ng-click="multi_view.close_item($parent.$parent.$index, $index)" translate>Close</li>
                </ul>
                <svg id="{{menu.tree_id}}" class="tree viewtab" ng-show="menu.mode == 'tree'">
                    <filter id="dropshadow" height="130%">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/> <!-- how much to blur -->
                        <feColorMatrix
                            type="matrix"
                            values="0.0  0.0  0.0  0.0  1.0
                                    0.0  0.0  0.0  0.0  1.0
                                    0.0  0.0  0.0  0.0  1.0
                                    0.0  0.0  0.0 10.0  0.0" />
                        <feOffset dx="0" dy="0" result="offsetblur"/> <!-- how much to offset -->
                        <feMerge> 
                            <feMergeNode/> <!-- the offset blurred image -->
                            <feMergeNode in="SourceGraphic"/> <!-- the element that the filter is applied to -->
                        </feMerge>
                    </filter>
                </svg>
                <div class="info viewtab" ng-show="menu.mode == 'info'">
                    <dl>
                        <dt>xref</dt>
                            <dd>{{ menu.selected_node.xref }}</dd>
                        <dt translate>Name</dt>
                            <dd>{{ menu.selected_node.name }}</dd>
                        <dt translate>Birth date</dt>
                            <dd>{{ menu.selected_node.data.birth_date_string || "--" }}</dd>
                        <dt translate>Death date</dt>
                            <dd>{{ menu.selected_node.data.death_date_string || "--" }}</dd>
                        <dt translate>Gender</dt>
                            <dd ng-if="menu.selected_node.data.sex == 'M'" translate>Male</dd>
                            <dd ng-if="menu.selected_node.data.sex == 'F'" translate>Female</dd>
                            <dd ng-if="menu.selected_node.data.sex == '?'" translate>Unknown</dd>
                    </dl>
                    <dl>
                        <dt>fuzzy index</dt>
                            <dd>{{ menu.selected_node.order_fuzzy_index }}</dd>
                        <dt>order reason</dt>
                            <dd>{{ menu.selected_node.order_reason }}</dd>
                    </dl>
                </div>
                <div class="testnote viewtab" ng-show="menu.mode == 'testnote'">
                    {{ menu.testnote }}
                </div>
                <div id="{{ menu.map_id }}" class="map viewtab" ng-show="menu.mode == 'map'">
                    <!-- #map will be moved here, as only one such can exist at a time -->
                </div>
                <div id="{{ menu.search_id }}" ng-show="menu.mode == 'search'">
                    <label><span translate>Search by</span>
                        <select class="search-by" ng-model="menu.search_by">
                            <option value="firstname" translate>First name</option>
                            <option value="familyname" translate>Family name</option>
                            <option value="xref">xref</option>
                        </select>
                    </label>
                    <label><span translate>Search term</span>
                        <input class="search-term" type="text" ng-model="menu.search_term"></input>
                    </label>
                    <button ng-click="menu.do_search()" translate>Search</button>
                    <div class="searchresults">
                        <div><span translate>For search:</span> {{ menu.search_result_term }}</div>
                        <div ng-repeat="ind in menu.search_result_list" ng-click="menu.load(ind.xref)">
                            {{ ind.name }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="add-row" ng-click="multi_view.add_item($index)">
                +
            </div>
        </div>
        <div class="add-column" ng-click="multi_view.add_column()">
            +
        </div>
    </div>
</div>
{% endraw %}
<div class="ng-hide">
    <div id="map">
    </div>
</div>
{% endblock %}
